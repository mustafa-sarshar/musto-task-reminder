"use strict";(self.webpackChunkmusto_task_reminder=self.webpackChunkmusto_task_reminder||[]).push([[33],{33:(k,_,i)=>{i.r(_),i.d(_,{ProfileModule:()=>J});var g=i(6895),s=i(4006),b=i(9299),D=i(8520),C=i(8962),a=i(2130),t=i(4650),c=i(3818);let A=(()=>{class o{constructor(e,n,r,p,h,d){this.appMonitoringService=e,this.utilityService=n,this.authService=r,this.logService=p,this.databaseService=h,this.dataFlowService=d,this.isDataFetching=!1}ngOnInit(){this.isDataFetchingSubscription=this.appMonitoringService.isDataFetching.subscribe(e=>{this.isDataFetching=e})}ngOnDestroy(){this.appMonitoringService.setIsDataFetchingStatus(!1),this.isDataFetchingSubscription?.unsubscribe()}initForm(){return new s.cw({username:new s.NI({value:"",disabled:this.isDataFetching},[s.kI.minLength(this.utilityService.getValidationMin("USERNAME")),s.kI.maxLength(this.utilityService.getValidationMax("USERNAME")),s.kI.pattern(this.utilityService.getValidationPattern("USERNAME"))]),birthDate:new s.NI({value:"",disabled:this.isDataFetching},[])})}stillEditingForm(e){let n=!1;return Object.keys(e.value).forEach(r=>{e.controls[r].value.length>0&&(n=!0)}),n}handleDeleteAccount(e,n,r){this.authService.handleDeleteUserAccount(e.token).subscribe({next:p=>{this.logService.logToConsole(new a.Z("The account is deleted successfully!","INFO")),this.databaseService.deleteUserProfileFromDatabase(e.uid).subscribe({next:h=>{this.logService.logToConsole(new a.Z("User profile is deleted successfully!","INFO")),this.logService.showNotification(new a.P("DELETE_ACCOUNT","SUCCESS")),this.authService.handleUserLogout(),this.appMonitoringService.setIsDataFetchingStatus(!1)},error:h=>{this.logService.logToConsole(new a.Z("User data could not be deleted!","ERROR")),this.logService.showNotification(new a.P("DELETE_USER_DATA","ERROR")),this.authService.handleUserLogout(),this.appMonitoringService.setIsDataFetchingStatus(!1)}})},error:p=>{this.logService.logToConsole(new a.Z("Deletion error:"+p.message,"ERROR")),this.logService.showNotification(new a.P("DELETE_ACCOUNT","ERROR")),this.appMonitoringService.setIsDataFetchingStatus(!1)}})}handleApplyChanges(e,n,r,p){this.databaseService.updateUserProfileDataInDatabase(e.uid,n).subscribe({next:h=>{this.logService.logToConsole(new a.Z("User account is updated successfully!","INFO")),this.logService.logToConsole(new a.Z(h)),this.logService.showNotification(new a.P("UPDATE_ACCOUNT","SUCCESS")),this.databaseService.getUserProfileDataFromDatabase(e.uid).subscribe({next:d=>{const f=this.dataFlowService.getUserData();f&&(f.username=d.username,f.birthDate=new Date(d.birthDate),this.dataFlowService.setUserData(f)),r&&r(),this.logService.logToConsole(new a.Z("User data updated successfully!","INFO")),this.logService.logToConsole(new a.Z(f)),this.logService.showNotification(new a.P("UPDATE_USER_DATA","SUCCESS"))},error:d=>{this.logService.logToConsole(new a.Z("User data could not get retrieved!"+d.message,"ERROR")),this.logService.showNotification(new a.P("UPDATE_USER_DATA","ERROR")),this.appMonitoringService.setIsDataFetchingStatus(!1)}}),this.appMonitoringService.setIsDataFetchingStatus(!1)},error:h=>{this.logService.logToConsole(new a.Z("User account could not be updated!"+h.message,"ERROR")),this.logService.showNotification(new a.P("UPDATE_ACCOUNT","ERROR")),this.appMonitoringService.setIsDataFetchingStatus(!1)}})}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(c.dS),t.LFG(c.tI),t.LFG(c.Tq),t.LFG(c.$V),t.LFG(c.k9),t.LFG(c.nA))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})();var F=i(340),x=i(6454),Z=i(6188),U=i(5938),u=i(3546),m=i(9549),v=i(4144),S=i(4859),E=i(7392);const T=["btnApplyChanges"];function M(o,l){1&o&&(t.TgZ(0,"li"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"MESSAGES.formValidation.user.username")," "))}function O(o,l){1&o&&(t.TgZ(0,"li"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"MESSAGES.formValidation.user.birthDate")," "))}function R(o,l){if(1&o&&(t.TgZ(0,"div",18)(1,"span",19),t._uU(2,"Help:"),t.qZA(),t.TgZ(3,"ul"),t.YNc(4,M,3,3,"li",20),t.YNc(5,O,3,3,"li",20),t.qZA()()),2&o){const e=t.oxw(3);t.xp6(4),t.Q6J("ngIf",!e.formGroupEl.controls.username.valid&&e.formGroupEl.controls.username.touched&&e.formGroupEl.controls.username.dirty),t.xp6(1),t.Q6J("ngIf",!e.formGroupEl.controls.birthDate.valid&&e.formGroupEl.controls.birthDate.touched&&e.formGroupEl.controls.birthDate.dirty)}}function I(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"mat-card",2)(1,"form",9)(2,"mat-card-header")(3,"mat-card-title",3),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"mat-card-content")(7,"mat-form-field",10)(8,"mat-label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"input",11),t.ALo(12,"translate"),t.TgZ(13,"mat-icon",12),t._uU(14,"person"),t.qZA()(),t.TgZ(15,"mat-form-field",10)(16,"mat-label"),t._uU(17),t.ALo(18,"translate"),t.qZA(),t._UZ(19,"input",13),t.ALo(20,"translate"),t.TgZ(21,"mat-icon",12),t._uU(22,"calendar_month"),t.qZA()()(),t.TgZ(23,"mat-card-footer")(24,"mat-card-actions",14)(25,"button",15),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.onClickReset())}),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"button",16),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.onClickApplyChanges())}),t._uU(29),t.ALo(30,"translate"),t.qZA()()(),t.YNc(31,R,6,2,"div",17),t.qZA()()}if(2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("formGroup",e.formGroupEl),t.xp6(3),t.hij(" ",t.lcZ(5,10,"USER_PROFILE.header.titleUpdateForm")," "),t.xp6(5),t.hij(" ",t.lcZ(10,12,"FORM_FIELDS.user.username.label")," "),t.xp6(2),t.Q6J("placeholder",t.lcZ(12,14,"FORM_FIELDS.user.email.label")),t.xp6(6),t.hij(" ",t.lcZ(18,16,"FORM_FIELDS.user.birthDate.label")," "),t.xp6(2),t.Q6J("placeholder",t.lcZ(20,18,"FORM_FIELDS.user.birthDate.label")),t.xp6(7),t.hij(" ",t.lcZ(27,20,"USER_PROFILE.actionButtons.reset.label")," "),t.xp6(2),t.Q6J("disabled",!e.formGroupEl.valid||e.isDataFetching),t.xp6(1),t.hij(" ",t.lcZ(30,22,"USER_PROFILE.actionButtons.applyChanges.label")," "),t.xp6(2),t.Q6J("ngIf",!e.formGroupEl.valid&&e.formGroupEl.touched&&e.formGroupEl.dirty&&(!e.formGroupEl.controls.username.valid&&e.formGroupEl.controls.username.touched&&e.formGroupEl.controls.username.dirty||!e.formGroupEl.controls.birthDate.valid&&e.formGroupEl.controls.birthDate.touched&&e.formGroupEl.controls.birthDate.dirty))}}function w(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title",3),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"mat-card-content",4)(7,"mat-card-subtitle",5)(8,"span"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"p")(12,"strong"),t._uU(13),t.qZA()(),t.TgZ(14,"span"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"p")(18,"strong"),t._uU(19),t.ALo(20,"date"),t.qZA()(),t.TgZ(21,"span"),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"p")(25,"strong"),t._uU(26),t.qZA()()()(),t.TgZ(27,"mat-card-footer")(28,"mat-card-actions",6)(29,"button",7),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onClickDeleteAccount())}),t._uU(30),t.ALo(31,"translate"),t.qZA()()()(),t.YNc(32,I,32,24,"mat-card",8),t.qZA()}if(2&o){const e=t.oxw();t.xp6(4),t.hij(" ",t.lcZ(5,10,"USER_PROFILE.header.titleUserInfo")," "),t.xp6(5),t.hij(" ",t.lcZ(10,12,"FORM_FIELDS.user.username.label"),": "),t.xp6(4),t.Oqu(e.userData.username),t.xp6(2),t.hij(" ",t.lcZ(16,14,"FORM_FIELDS.user.birthDate.label"),": "),t.xp6(4),t.Oqu(t.xi3(20,16,e.userData.birthDate,"fullDate")),t.xp6(3),t.hij(" ",t.lcZ(23,19,"FORM_FIELDS.user.email.label"),": "),t.xp6(4),t.Oqu(e.userData.email),t.xp6(3),t.Q6J("disabled",e.isDataFetching||!e.userData.username),t.xp6(1),t.hij(" ",t.lcZ(31,21,"USER_PROFILE.actionButtons.deleteAccount.label")," "),t.xp6(2),t.Q6J("ngIf",e.formGroupEl)}}const y=[{path:"",component:(()=>{class o{constructor(e,n,r,p,h,d,f){this.appMonitoringService=e,this.logService=n,this.dataFlowService=r,this.profileService=p,this.utilityService=h,this.translateService=d,this.dialog=f,this.userData=null,this.isDataFetching=!1,this.hidePasswordValue=!0}ngOnInit(){this.appMonitoringService.setIsDataFetchingStatus(!0),this.dataFlowService.applyAppLanguage(),this.appLanguageSubscription=this.dataFlowService.appLanguage.subscribe(e=>{this.translateService.use(e)}),this.formGroupEl=this.profileService.initForm(),this.isDataFetchingSubscription=this.appMonitoringService.isDataFetching.subscribe(e=>{this.isDataFetching=e}),this.appLanguageSubscription=this.dataFlowService.userData.subscribe(e=>{this.userData=e,this.logService.logToConsole(new a.Z("User Data loaded @Tasks","INFO")),this.logService.logToConsole(new a.Z(e)),this.appMonitoringService.setIsDataFetchingStatus(!1)})}ngOnDestroy(){this.appMonitoringService.setIsDataFetchingStatus(!1),this.isDataFetchingSubscription?.unsubscribe(),this.appLanguageSubscription?.unsubscribe()}onCanDeactivate(){if(this.formGroupEl&&this.profileService.stillEditingForm(this.formGroupEl)||this.isDataFetching){const e=this.dialog.open(C.z,x.KO);return e.componentInstance.confirmationDialogBox=new F.O("LEAVE_PAGE","OK/CANCEL"),e.afterClosed()}return!0}onClickDeleteAccount(){if(this.userData?.username){const e=this.dialog.open(C.z,x.KO);e.componentInstance.confirmationDialogBox=new F.O("DELETE_ACCOUNT","YES/NO"),e.afterClosed().subscribe(n=>{n&&this.userData&&this.profileService.handleDeleteAccount(this.userData)})}}onClickReset(){this.formGroupEl?.setValue({username:"",birthDate:""})}onClickApplyChanges(){const e={};this.formGroupEl?.controls.username.value&&(e.username=this.formGroupEl.controls.username.value),this.formGroupEl?.controls.birthDate.value&&(e.birthDate=this.formGroupEl?.controls.birthDate.value),this.userData&&e&&this.profileService.handleApplyChanges(this.userData,e,()=>this.formGroupEl?.setValue({username:"",birthDate:""}))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.dS),t.Y36(c.$V),t.Y36(c.nA),t.Y36(A),t.Y36(c.tI),t.Y36(Z.sK),t.Y36(U.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-profile"]],viewQuery:function(e,n){if(1&e&&t.Gf(T,5),2&e){let r;t.iGM(r=t.CRH())&&(n.btnApplyChangesEl=r.first)}},features:[t._Bn([A])],decls:1,vars:1,consts:[["class","profile__container",4,"ngIf"],[1,"profile__container"],[1,"profile__item"],[1,"profile__title"],[1,"profile__body"],[1,"profile__userInfo"],[1,"page-actions"],["mat-stroked-button","","type","button",1,"element__bg--error","element__color--light",3,"disabled","click"],["class","profile__item",4,"ngIf"],["autoComplete","off",3,"formGroup"],["appearance","outline","color","accent"],["matInput","","type","text","formControlName","username","id","username",3,"placeholder"],["color","default","matSuffix",""],["matInput","","type","date","formControlName","birthDate","id","birth",3,"placeholder"],["align","end",1,"page-actions"],["mat-stroked-button","","type","button",1,"element__bg--error","element__color--light","element__mr--10",3,"click"],["mat-raised-button","","type","button","color","default",1,"element__color--light",3,"disabled","click"],["class","help-box",4,"ngIf"],[1,"help-box"],[1,"help-box__title"],[4,"ngIf"]],template:function(e,n){1&e&&t.YNc(0,w,33,23,"div",0),2&e&&t.Q6J("ngIf",n.userData)},dependencies:[g.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,u.a8,u.hq,u.dn,u.rt,u.dk,u.$j,u.n5,m.KE,m.hX,m.R9,v.Nt,S.lW,E.Hw,g.uU,Z.X$],styles:[".profile__container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;width:100%}.profile__title[_ngcontent-%COMP%]{padding:2rem;text-align:center;font-weight:700}.profile__item[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;flex-direction:column;align-items:center;margin:1.5rem;max-width:300px;width:100%;box-shadow:none;background-color:transparent}@media all and (max-width: 550px){.profile__item[_ngcontent-%COMP%]:first-child{padding-bottom:1rem;border-bottom:1px solid lightgray}}.profile__body[_ngcontent-%COMP%]{padding-top:.5rem;margin-bottom:1rem}.profile__userInfo[_ngcontent-%COMP%]{margin-bottom:.5;overflow:hidden}.profile__userInfo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{overflow-wrap:break-word;width:270px}.profile__userInfo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(even){margin-bottom:1rem}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:0}"]}),o})(),canActivate:[D.a1],canDeactivate:[D.Fi]}];let L=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[b.Bz.forChild(y),b.Bz]}),o})();var P=i(7009);const G=[u.QW,m.lN,v.c,S.ot,E.Ps,P.ZX];let N=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[G,u.QW,m.lN,v.c,S.ot,E.Ps,P.ZX]}),o})();var j=i(2775);let J=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.ez,L,s.UX,N,j.Z]}),o})()}}]);