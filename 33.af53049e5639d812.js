"use strict";(self.webpackChunkmusto_task_reminder=self.webpackChunkmusto_task_reminder||[]).push([[33],{33:(k,E,a)=>{a.r(E),a.d(E,{ProfileModule:()=>j});var m=a(6895),l=a(4006),F=a(9299),C=a(8520),S=a(727),A=a(8962),n=a(2130),e=a(4650),c=a(8783);let Z=(()=>{class o{constructor(t,i,s,d,h,p){this.appMonitoringService=t,this.utilityService=i,this.authService=s,this.logService=d,this.databaseService=h,this.dataFlowService=p,this.isDataFetching=!1,this.isDataFetchingSubscription=new S.w0}ngOnInit(){this.isDataFetchingSubscription=this.appMonitoringService.isDataFetching.subscribe(t=>{this.isDataFetching=t})}ngOnDestroy(){this.appMonitoringService.setIsDataFetchingStatus(!1),this.isDataFetchingSubscription.unsubscribe()}initForm(){return new l.cw({username:new l.NI({value:"",disabled:this.isDataFetching},[l.kI.minLength(this.utilityService.getValidationLengthMin("USERNAME")),l.kI.maxLength(this.utilityService.getValidationLengthMax("USERNAME")),l.kI.pattern(this.utilityService.getValidationPattern("USERNAME"))]),birthDate:new l.NI({value:"",disabled:this.isDataFetching},[this.utilityService.validateAge])})}stillEnteringForm(t){let i=!1;return Object.keys(t.value).forEach(s=>{t.controls[s].value.length>0&&(i=!0)}),i}handleDeleteAccount(t,i,s){this.authService.handleDeleteUserAccount(t.token).subscribe({next:d=>{this.logService.logToConsole(new n.Z("The account is deleted successfully!","INFO")),this.databaseService.deleteUserProfileFromDatabase(t.uid).subscribe({next:h=>{this.logService.logToConsole(new n.Z("User profile is deleted successfully!","INFO")),this.logService.showNotification(new n.P("DELETE_ACCOUNT","SUCCESS")),this.authService.handleUserLogout(),this.appMonitoringService.setIsDataFetchingStatus(!1)},error:h=>{this.logService.logToConsole(new n.Z("User data could not be deleted!","ERROR")),this.logService.showNotification(new n.P("DELETE_USER_DATA","ERROR")),this.authService.handleUserLogout(),this.appMonitoringService.setIsDataFetchingStatus(!1)}})},error:d=>{this.logService.logToConsole(new n.Z("Deletion error:"+d.message,"ERROR")),this.logService.showNotification(new n.P("DELETE_ACCOUNT","ERROR")),this.appMonitoringService.setIsDataFetchingStatus(!1)}})}handleApplyChanges(t,i,s,d){this.databaseService.updateUserProfileDataInDatabase(t.uid,i).subscribe({next:h=>{this.logService.logToConsole(new n.Z("User account is updated successfully!","INFO")),this.logService.logToConsole(new n.Z(h)),this.logService.showNotification(new n.P("UPDATE_ACCOUNT","SUCCESS")),this.databaseService.getUserProfileDataFromDatabase(t.uid).subscribe({next:p=>{const f=this.dataFlowService.getUserData();f.username=p.username,f.birthDate=new Date(p.birthDate),this.dataFlowService.setUserData(f),s(),this.logService.logToConsole(new n.Z("User data updated successfully!","INFO")),this.logService.logToConsole(new n.Z(f)),this.logService.showNotification(new n.P("UPDATE_USER_DATA","SUCCESS"))},error:p=>{this.logService.logToConsole(new n.Z("User data could not get retrieved!"+p.message,"ERROR")),this.logService.showNotification(new n.P("UPDATE_USER_DATA","ERROR")),this.appMonitoringService.setIsDataFetchingStatus(!1)}}),this.appMonitoringService.setIsDataFetchingStatus(!1)},error:h=>{this.logService.logToConsole(new n.Z("User account could not be updated!"+h.message,"ERROR")),this.logService.showNotification(new n.P("UPDATE_ACCOUNT","ERROR")),this.appMonitoringService.setIsDataFetchingStatus(!1)}})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(c.dS),e.LFG(c.tI),e.LFG(c.Tq),e.LFG(c.$V),e.LFG(c.k9),e.LFG(c.nA))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})();var P=a(340),U=a(6454),O=a(6188),y=a(5938),u=a(3546),g=a(9549),v=a(4144),b=a(4859),D=a(7392);const R=["btnApplyChanges"];function T(o,r){1&o&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"MESSAGES.formValidation.user.username")," "))}function M(o,r){1&o&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"MESSAGES.formValidation.user.birthDate")," "))}function I(o,r){if(1&o&&(e.TgZ(0,"div",16)(1,"span",17),e._uU(2,"Help:"),e.qZA(),e.TgZ(3,"ul"),e.YNc(4,T,3,3,"li",18),e.YNc(5,M,3,3,"li",18),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",!t.formGroupEl.controls.username.valid&&t.formGroupEl.controls.username.touched&&t.formGroupEl.controls.username.dirty),e.xp6(1),e.Q6J("ngIf",!t.formGroupEl.controls.birthDate.valid&&t.formGroupEl.controls.birthDate.touched&&t.formGroupEl.controls.birthDate.dirty)}}const L=[{path:"",component:(()=>{class o{constructor(t,i,s,d,h,p,f){this.appMonitoringService=t,this.logService=i,this.dataFlowService=s,this.profileService=d,this.utilityService=h,this.translateService=p,this.dialog=f,this.userData=null,this.isDataFetching=!1,this.hidePasswordValue=!0,this.isDataFetchingSubscription=new S.w0,this.appLanguageSubscription=new S.w0}ngOnInit(){this.appMonitoringService.setIsDataFetchingStatus(!0),this.dataFlowService.applyAppLanguage(),this.appLanguageSubscription=this.dataFlowService.appLanguage.subscribe(t=>{this.translateService.use(t)}),this.formGroupEl=this.profileService.initForm(),this.isDataFetchingSubscription=this.appMonitoringService.isDataFetching.subscribe(t=>{this.isDataFetching=t}),this.appLanguageSubscription=this.dataFlowService.userData.subscribe(t=>{this.userData=t,this.logService.logToConsole(new n.Z("User Data loaded @Tasks","INFO")),this.logService.logToConsole(new n.Z(t)),this.appMonitoringService.setIsDataFetchingStatus(!1)})}ngOnDestroy(){this.appMonitoringService.setIsDataFetchingStatus(!1),this.isDataFetchingSubscription.unsubscribe(),this.appLanguageSubscription.unsubscribe()}onCanDeactivate(){if(this.profileService.stillEnteringForm(this.formGroupEl)||this.isDataFetching){const t=this.dialog.open(A.z,U.KO);return t.componentInstance.confirmationDialogBox=new P.O("Be careful!","If you leave the page now, you will discard the changes!","OK/CANCEL"),t.afterClosed()}return!0}onClickDeleteAccount(){if(this.userData.username){const t=this.dialog.open(A.z,U.KO);t.componentInstance.confirmationDialogBox=new P.O("Be careful!","Do you really want to delete your account?","YES/NO"),t.afterClosed().subscribe(i=>{i&&this.profileService.handleDeleteAccount(this.userData)})}}onClickReset(){this.formGroupEl.reset({username:"",birthDate:""})}onClickApplyChanges(){const t={};this.formGroupEl.controls.username.value&&(t.username=this.formGroupEl.controls.username.value),this.formGroupEl.controls.birthDate.value&&(t.birthDate=this.formGroupEl.controls.birthDate.value),this.profileService.handleApplyChanges(this.userData,t,()=>this.formGroupEl.reset({username:"",birthDate:""}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.dS),e.Y36(c.$V),e.Y36(c.nA),e.Y36(Z),e.Y36(c.tI),e.Y36(O.sK),e.Y36(y.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-profile"]],viewQuery:function(t,i){if(1&t&&e.Gf(R,5),2&t){let s;e.iGM(s=e.CRH())&&(i.btnApplyChangesEl=s.first)}},features:[e._Bn([Z])],decls:64,vars:46,consts:[[1,"profile__container"],[1,"profile__item"],[1,"profile__title"],[1,"profile__body"],[1,"profile__userInfo"],[1,"page-actions"],["mat-stroked-button","","color","warn",3,"disabled","click"],["autoComplete","off",3,"formGroup"],["appearance","outline","color","accent"],["matInput","","type","text","formControlName","username","id","username",3,"placeholder"],["color","default","matSuffix",""],["matInput","","type","date","formControlName","birthDate","id","birth",3,"placeholder"],["align","end",1,"page-actions"],["mat-stroked-button","","type","button",3,"disabled","click"],["mat-stroked-button","","color","warn","type","button",3,"click"],["class","help-box",4,"ngIf"],[1,"help-box"],[1,"help-box__title"],[4,"ngIf"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title",2),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"mat-card-content",3)(7,"mat-card-subtitle",4)(8,"span"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"p")(12,"strong"),e._uU(13),e.qZA()(),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"p")(18,"strong"),e._uU(19),e.ALo(20,"date"),e.qZA()(),e.TgZ(21,"span"),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"p")(25,"strong"),e._uU(26),e.qZA()()()(),e.TgZ(27,"mat-card-footer")(28,"mat-card-actions",5)(29,"button",6),e.NdJ("click",function(){return i.onClickDeleteAccount()}),e._uU(30),e.ALo(31,"translate"),e.qZA()()()(),e.TgZ(32,"mat-card",1)(33,"form",7)(34,"mat-card-header")(35,"mat-card-title",2),e._uU(36),e.ALo(37,"translate"),e.qZA()(),e.TgZ(38,"mat-card-content")(39,"mat-form-field",8)(40,"mat-label"),e._uU(41),e.ALo(42,"translate"),e.qZA(),e._UZ(43,"input",9),e.ALo(44,"translate"),e.TgZ(45,"mat-icon",10),e._uU(46,"person"),e.qZA()(),e.TgZ(47,"mat-form-field",8)(48,"mat-label"),e._uU(49),e.ALo(50,"translate"),e.qZA(),e._UZ(51,"input",11),e.ALo(52,"translate"),e.TgZ(53,"mat-icon",10),e._uU(54,"calendar_month"),e.qZA()()(),e.TgZ(55,"mat-card-footer")(56,"mat-card-actions",12)(57,"button",13),e.NdJ("click",function(){return i.onClickApplyChanges()}),e._uU(58),e.ALo(59,"translate"),e.qZA(),e.TgZ(60,"button",14),e.NdJ("click",function(){return i.onClickReset()}),e._uU(61),e.ALo(62,"translate"),e.qZA()()(),e.YNc(63,I,6,2,"div",15),e.qZA()()()),2&t&&(e.xp6(4),e.hij(" ",e.lcZ(5,19,"USER_PROFILE.header.titleUserInfo")," "),e.xp6(5),e.hij(" ",e.lcZ(10,21,"FORM_FIELDS.user.username.label"),": "),e.xp6(4),e.Oqu(i.userData.username),e.xp6(2),e.hij(" ",e.lcZ(16,23,"FORM_FIELDS.user.birthDate.label"),": "),e.xp6(4),e.Oqu(e.xi3(20,25,i.userData.birthDate,"fullDate")),e.xp6(3),e.hij(" ",e.lcZ(23,28,"FORM_FIELDS.user.email.label"),": "),e.xp6(4),e.Oqu(i.userData.email),e.xp6(3),e.Q6J("disabled",i.isDataFetching||!i.userData.username),e.xp6(1),e.hij(" ",e.lcZ(31,30,"USER_PROFILE.actionButtons.deleteAccount.label")," "),e.xp6(3),e.Q6J("formGroup",i.formGroupEl),e.xp6(3),e.hij(" ",e.lcZ(37,32,"USER_PROFILE.header.titleUpdateForm")," "),e.xp6(5),e.hij(" ",e.lcZ(42,34,"FORM_FIELDS.user.username.label")," "),e.xp6(2),e.Q6J("placeholder",e.lcZ(44,36,"FORM_FIELDS.user.email.label")),e.xp6(6),e.hij(" ",e.lcZ(50,38,"FORM_FIELDS.user.birthDate.label")," "),e.xp6(2),e.Q6J("placeholder",e.lcZ(52,40,"FORM_FIELDS.user.birthDate.label")),e.xp6(6),e.Q6J("disabled",!i.formGroupEl.valid||i.isDataFetching),e.xp6(1),e.hij(" ",e.lcZ(59,42,"USER_PROFILE.actionButtons.applyChanges.label")," "),e.xp6(3),e.hij(" ",e.lcZ(62,44,"USER_PROFILE.actionButtons.reset.label")," "),e.xp6(2),e.Q6J("ngIf",!i.formGroupEl.valid&&i.formGroupEl.touched&&i.formGroupEl.dirty&&(!i.formGroupEl.controls.username.valid&&i.formGroupEl.controls.username.touched&&i.formGroupEl.controls.username.dirty||!i.formGroupEl.controls.birthDate.valid&&i.formGroupEl.controls.birthDate.touched&&i.formGroupEl.controls.birthDate.dirty)))},dependencies:[m.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,u.a8,u.hq,u.dn,u.rt,u.dk,u.$j,u.n5,g.KE,g.hX,g.R9,v.Nt,b.lW,D.Hw,m.uU,O.X$],styles:[".profile__container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;width:100%}.profile__title[_ngcontent-%COMP%]{padding:2rem;text-align:center;font-weight:700}.profile__item[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;flex-direction:column;align-items:center;margin:1.5rem;max-width:300px;width:100%;box-shadow:none;background-color:transparent}@media all and (max-width: 550px){.profile__item[_ngcontent-%COMP%]:first-child{padding-bottom:1rem;border-bottom:1px solid lightgray}}.profile__body[_ngcontent-%COMP%]{padding-top:.5rem;margin-bottom:1rem}.profile__userInfo[_ngcontent-%COMP%]{margin-bottom:.5;overflow:hidden}.profile__userInfo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{overflow-wrap:break-word;width:270px}.profile__userInfo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(even){margin-bottom:1rem}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:0}"]}),o})(),canActivate:[C.a1],canDeactivate:[C.Fi]}];let x=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[F.Bz.forChild(L),F.Bz]}),o})();var w=a(7009);const G=[u.QW,g.lN,v.c,b.ot,D.Ps,w.ZX];let N=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[G,u.QW,g.lN,v.c,b.ot,D.Ps,w.ZX]}),o})();var _=a(2775);let j=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.ez,x,l.UX,N,_.Z]}),o})()}}]);